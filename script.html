<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <!-- Google Code for Remarketing Tag -->
    <!--------------------------------------------------
Remarketing tags may not be associated with personally identifiable information or placed on pages related to sensitive categories. See more information and instructions on how to setup the tag on: http://google.com/ads/remarketingsetup
--------------------------------------------------->
    <script type="text/javascript">
      /* <![CDATA[ */
      var google_conversion_id = 874211379;
      var google_custom_params = window.google_tag_params;
      var google_remarketing_only = true;
      /* ]]> */
    </script>
    <script
      type="text/javascript"
      src="//www.googleadservices.com/pagead/conversion.js"
    ></script>
    <noscript>
      <div style="display: inline">
        <img
          height="1"
          width="1"
          style="border-style: none"
          alt=""
          src="//googleads.g.doubleclick.net/pagead/viewthroughconversion/874211379/?guid=ON&amp;script=0"
        />
      </div>
    </noscript>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-TG7W5HLF");
    </script>
    <!-- End Google Tag Manager -->

    <!-- LinkedIn Remarketing Tag -->
    <script type="text/javascript">
      _linkedin_partner_id = "3936932";
      window._linkedin_data_partner_ids =
        window._linkedin_data_partner_ids || [];
      window._linkedin_data_partner_ids.push(_linkedin_partner_id);
    </script>
    <script type="text/javascript">
      (function (l) {
        if (!l) {
          window.lintrk = function (a, b) {
            window.lintrk.q.push([a, b]);
          };
          window.lintrk.q = [];
        }
        var s = document.getElementsByTagName("script")[0];
        var b = document.createElement("script");
        b.type = "text/javascript";
        b.async = true;
        b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
        s.parentNode.insertBefore(b, s);
      })(window.lintrk);
    </script>
    <noscript>
      <img
        height="1"
        width="1"
        style="display: none"
        alt=""
        src="https://px.ads.linkedin.com/collect/?pid=3936932&fmt=gif"
      />
    </noscript>
    <!-- END LinkedIn Remarketing Tag -->

    <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.5/dist/js.cookie.min.js"></script>

    <!-- Swiper JS -->
    <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

    <script src="https://29101afcd41198dafcdd8b88cbac692a.cdn.bubble.io/f1755712780764x618132097773047300/utils.js"></script>

    <script src="https://29101afcd41198dafcdd8b88cbac692a.cdn.bubble.io/f1755712737202x523600794765929600/phn.js"></script>

    <script>
      var swiper = new Swiper(".lg_swipper", {
        slidesPerView: 6,
        spaceBetween: 30,
        pagination: {
          el: ".swiper-pagination",
          clickable: true,
        },
        autoplay: {
          delay: 5000,
        },

        breakpoints: {
          0: {
            slidesPerView: 3,
            spaceBetween: 10,
          },
          577: {
            slidesPerView: 3,
            spaceBetween: 10,
          },
          768: {
            slidesPerView: 3,
            spaceBetween: 30,
          },
          992: {
            slidesPerView: 6,
            spaceBetween: 20,
          },
        },
      });
    </script>

    <script>
      //utlity js
      // Utility functions for authentication system

      function showAuthFormsWrapper() {
        const authFormsWrapper = document.getElementById("authFormsWrapper");
        if (authFormsWrapper) {
          authFormsWrapper.style.display = "block";
        }
      }

      function hideAuthFormsWrapper() {
        const authFormsWrapper = document.getElementById("authFormsWrapper");
        if (authFormsWrapper) {
          authFormsWrapper.style.display = "none";
        }
      }

      function updateUIForLoggedInUser(userEmail) {
        const userEmailDisplay = document.getElementById("userEmail");
        const logoutBtn = document.getElementById("logoutBtn");
        // Function to update price visibility
        function updatePriceVisibility() {
          const priceElements = document.querySelectorAll(".item_book .price");
          const signUpBar = document.querySelector(".floating_signup");
          const priceBar = document.querySelectorAll(".view_price_tologin");
          const brokerPax = document.querySelectorAll(".brokerprice_mode");
          if (userEmail && typeof userEmail === "string") {
            priceElements.forEach((price) => {
              price.style.filter = "none";
            });

            if (brokerPax) {
              brokerPax.forEach((brokerprc) => {
                brokerprc.style.filter = "none";
              });
            }

            if (signUpBar) signUpBar.style.display = "none";
            if (priceBar && priceBar.length > 0) {
              priceBar.forEach((bar) => {
                bar.style.display = "none";
              });
            }
          } else {
            priceElements.forEach((price) => {
              price.style.filter = "blur(5px)";
              price.style.userSelect = "none";
              price.style.webkitUserSelect = "none";
              price.style.msUserSelect = "none";
            });

            if (brokerPax) {
              brokerPax.forEach((brokerprc) => {
                brokerprc.style.filter = "blur(5px)";
                brokerprc.style.userSelect = "none";
                brokerprc.style.webkitUserSelect = "none";
                brokerprc.style.msUserSelect = "none";
              });
            }

            if (signUpBar) signUpBar.style.display = "block";
            if (priceBar && priceBar.length > 0) {
              priceBar.forEach((bar) => {
                bar.style.display = "block";
              });
            }
          }
        }

        // Create observer for price elements
        const observer = new MutationObserver((mutations) => {
          mutations.forEach((mutation) => {
            if (mutation.addedNodes.length) {
              updatePriceVisibility();
            }
          });
        });

        // Start observing
        observer.observe(document.body, {
          childList: true,
          subtree: true,
        });

        if (userEmail && typeof userEmail === "string") {
          const firstLetter = userEmail.charAt(0).toUpperCase();
          userEmailDisplay.textContent = firstLetter;
          userEmailDisplay.style.display = "inline-block";
          document.querySelector(".usermailtext").style.display = "flex";
          document.querySelector(".usermailtext").title = userEmail;
          logoutBtn.style.display = "inline-block";
          hideAuthFormsWrapper();
          document.querySelector(".hd_signup").style.display = "none";
          document.querySelector(".hd_login").style.display = "none";
        } else {
          document.querySelector(".usermailtext").style.display = "none";
          logoutBtn.style.display = "none";
          showAuthFormsWrapper();
          document.querySelector(".hd_signup").style.display = "flex";
          document.querySelector(".hd_login").style.display = "flex";

          if (localStorage.getItem("aircraft_details")) {
            localStorage.removeItem("aircraft_details");
          }
        }
      }

      // Check login status
      function checkLoginStatus() {
        const userEmail = Cookies.get("userEmail");
        const authToken = Cookies.get("authToken");

        if (userEmail && authToken) {
          updateUIForLoggedInUser(userEmail);
          // Check and send flight request IDs if user is logged in
          sendFlightRequestIdsIfLoggedIn();
        } else {
          updateUIForLoggedInUser(null);
        }
      }

      // Save user details in session storage from API response
      function saveUserDetailsToSession(apiData) {
        try {
          const responseData = (apiData && apiData.response) || {};
          const details = {
            firstName: responseData.firstname || "",
            lastName: responseData.lastname || "",
            email: responseData.email || "",
            phone: responseData.phone || "",
          };
          sessionStorage.setItem("userDetails", JSON.stringify(details));
        } catch (e) {
          console.error("Failed to save user details to session", e);
        }
      }

      // Export functions to global scope
      window.showAuthFormsWrapper = showAuthFormsWrapper;
      window.hideAuthFormsWrapper = hideAuthFormsWrapper;
      window.updateUIForLoggedInUser = updateUIForLoggedInUser;
      window.checkLoginStatus = checkLoginStatus;

      // Initialize auth forms wrapper on page load
      document.addEventListener("DOMContentLoaded", () => {
        hideAuthFormsWrapper();
        checkLoginStatus(); // This will check and send flight request IDs
      });

      //toast js
      class Toast {
        constructor(element) {
          this.element = element;
        }

        show() {
          this.element.classList.add("show");
          // Auto-hide after 5 seconds
          setTimeout(() => this.hide(), 8000);
        }

        hide() {
          this.element.classList.remove("show");
        }
      }

      // Initialize toast when DOM is loaded
      document.addEventListener("DOMContentLoaded", () => {
        window.toast = new Toast(document.getElementById("notificationToast"));
      });

      //form.js
      document.addEventListener("DOMContentLoaded", () => {
        // Get form elements
        const loginForm = document.getElementById("loginForm");
        const signupForm = document.getElementById("signupForm");
        const forgotPasswordForm =
          document.getElementById("forgotPasswordForm");
        const logoutBtn = document.getElementById("logoutBtn");

        // Get navigation links
        const showSignupLink = document.getElementById("showSignup");
        const showLoginLink = document.getElementById("showLogin");
        const showForgotPasswordLink =
          document.getElementById("showForgotPassword");
        const backToLoginLink = document.getElementById("backToLogin");

        // Function to show a specific form and hide others
        const showForm = (formToShow) => {
          [loginForm, signupForm, forgotPasswordForm].forEach((form) => {
            form.style.display = form === formToShow ? "flex" : "none";
          });
        };

        // Event listeners for navigation
        showSignupLink.addEventListener("click", (e) => {
          e.preventDefault();
          showForm(signupForm);
        });

        showLoginLink.addEventListener("click", (e) => {
          e.preventDefault();
          showForm(loginForm);
        });

        showForgotPasswordLink.addEventListener("click", (e) => {
          e.preventDefault();
          showForm(forgotPasswordForm);
        });

        backToLoginLink.addEventListener("click", (e) => {
          e.preventDefault();
          showForm(loginForm);
        });

        signupForm.querySelector("form").addEventListener("submit", (e) => {
          e.preventDefault();
          const password = document.getElementById("signupPassword").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;

          if (password !== confirmPassword) {
            alert("Passwords do not match!");
            return;
          }
        });

        // Logout handler
        logoutBtn.addEventListener("click", () => {
          logoutBtn.style.display = "none";
          document.getElementById("userEmail").style.display = "none";
          document.getElementById("userEmail").textContent = "";
          // showForm(loginForm);
        });

        // code for close button in pobup from. when user will click in x cross button popup will hide
        document.querySelectorAll("img.close_img").forEach((closebtn) => {
          closebtn.addEventListener("click", function () {
            closebtn.closest(".auth-form").style.display = "none";
          });
        });

        // code for open login and signup form when user will click in signup and login form main header
        const signUp = document.querySelector(".hd_signup");
        const login = document.querySelector(".hd_login");

        signUp.addEventListener("click", () => {
          signupForm.style.display = "flex";
          loginForm.style.display = "none";
        });

        login.addEventListener("click", () => {
          loginForm.style.display = "flex";
          signupForm.style.display = "none";
        });
      });

      // Utility function to send flightRequestIds if logged in
      async function sendFlightRequestIdsIfLoggedIn() {
        const userEmail = Cookies.get("userEmail");
        const authToken = Cookies.get("authToken");
        const isLoggedIn = userEmail && authToken;
        const storedData = sessionStorage.getItem("flightRequestId");
        const flightRequestIds = JSON.parse(storedData || "[]");

        if (isLoggedIn && flightRequestIds.length > 0) {
          try {
            const response = await fetch(
              "https://operators-dashboard.bubbleapps.io/api/1.1/wf/save_session_requests",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                  Authorization: `Bearer ${authToken}`,
                },
                body: JSON.stringify({ flightrequestids: flightRequestIds }),
              }
            );

            const responseData = await response.json();

            if (response.ok) {
              sessionStorage.removeItem("flightRequestId");
            } else {
              console.error(
                "Failed to send to backend:",
                response.status,
                response.statusText
              );
            }
          } catch (err) {
            console.error("Error sending to backend:", err);
          }
        }
      }
      window.sendFlightRequestIdsIfLoggedIn = sendFlightRequestIdsIfLoggedIn;

      //sign up.js
      document.addEventListener("DOMContentLoaded", () => {
        const signupForm = document
          .getElementById("signupForm")
          .querySelector("form");
        const toastMessage = document.getElementById("toastMessage");

        signupForm.addEventListener("submit", async (e) => {
          e.preventDefault();

          const email = document.getElementById("signupEmail").value;
          const password = document.getElementById("signupPassword").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;

          // Basic validation
          if (password !== confirmPassword) {
            toastMessage.textContent = "Passwords do not match!";
            toast.show();
            return;
          }

          const title = document
            .querySelector(".iti__selected-flag")
            .getAttribute("title");
          const plusWithNumber = title.match(/\+\d+/)[0];
          const phoneNumber = document.querySelector("#phone");
          const phone = plusWithNumber + phoneNumber.value;
          try {
            const response = await fetch(
              "https://operators-dashboard.bubbleapps.io/api/1.1/wf/webflow_signup",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  email: email,
                  password: password,
                  phone,
                }),
              }
            );

            const data = await response.json();
            console.log(data);

            if (response.ok) {
              // Use the email from signup form directly
              const userEmail = email;

              // Store user data in cookies
              Cookies.set("userEmail", userEmail, { expires: 7, secure: true });
              if (data.response && data.response.token) {
                Cookies.set("authToken", data.response.token, {
                  expires: 7,
                  secure: true,
                });
              }

              // Save user details from API response to session storage
              saveUserDetailsToSession(data);

              // Update UI
              updateUIForLoggedInUser(userEmail);
              document.getElementById("signupForm").style.display = "none";
              toastMessage.textContent = "Signup successful!";
              toast.show();

              // Send flight request IDs if any exist
              sendFlightRequestIdsIfLoggedIn();

              // Clear the form
              signupForm.reset();
              const currentPath = window.location.pathname;
              if (
                (currentPath === "/aircraft" || currentPath === "/aircraft/") &&
                localStorage.getItem("aircraft_details")
              ) {
                window.location.href = "/checkout";
              }
            } else {
              toastMessage.textContent =
                "Signup failed: " + (data.message || "Unknown error");
              toast.show();
            }
          } catch (error) {
            toastMessage.textContent =
              "An error occurred during signup. Please try again.";
            toast.show();
          }
        });
      });

      //login.js
      document.addEventListener("DOMContentLoaded", () => {
        const loginForm = document
          .getElementById("loginForm")
          .querySelector("form");
        const toast = window.toast;
        const toastMessage = document.getElementById("toastMessage");
        const logoutBtn = document.getElementById("logoutBtn");

        loginForm.addEventListener("submit", async (e) => {
          e.preventDefault();

          const email = document.getElementById("loginEmail").value;
          const password = document.getElementById("loginPassword").value;

          try {
            const response = await fetch(
              "https://operators-dashboard.bubbleapps.io/api/1.1/wf/webflow_login",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  email: email,
                  password: password,
                }),
              }
            );

            const data = await response.json();

            console.log(data);

            if (response.ok) {
              if (data && data.response) {
                const userEmail = email;

                if (userEmail) {
                  // Store user data in cookies
                  Cookies.set("userEmail", userEmail, {
                    expires: 7,
                    secure: true,
                  });
                  if (data.response.token) {
                    Cookies.set("authToken", data.response.token, {
                      expires: 7,
                      secure: true,
                    });
                  }

                  // Save user details from API response to session storage
                  saveUserDetailsToSession(data);

                  // Update UI
                  updateUIForLoggedInUser(userEmail);
                  document.getElementById("loginForm").style.display = "none";
                  toastMessage.textContent = "Login successful!";
                  toast.show();

                  // Send flight request IDs if any exist
                  sendFlightRequestIdsIfLoggedIn();

                  // Clear the form
                  loginForm.reset();
                  const currentPath = window.location.pathname;
                  if (
                    (currentPath === "/aircraft" ||
                      currentPath === "/aircraft/") &&
                    localStorage.getItem("aircraft_details")
                  ) {
                    window.location.href = "/checkout";
                  }
                }
              }
            } else {
              toastMessage.textContent =
                "Login failed: " + (data.message || "Invalid credentials");
              toast.show();
            }
          } catch (error) {
            toastMessage.textContent =
              "An error occurred during login. Please try again.";
            toast.show();
          }
        });

        // Handle logout
        logoutBtn.addEventListener("click", () => {
          // Clear cookies
          Cookies.remove("userEmail");
          Cookies.remove("authToken");

          // Clear session user details
          sessionStorage.removeItem("userDetails");

          // Update UI for logged out user
          updateUIForLoggedInUser(null);
          toastMessage.textContent = "Logged out successfully!";
          toast.show();
        });
      });

      //forget_password.js
      document.addEventListener("DOMContentLoaded", () => {
        const forgotPasswordForm = document
          .getElementById("forgotPasswordForm")
          .querySelector("form");
        const toast = window.toast;
        const toastMessage = document.getElementById("toastMessage");

        forgotPasswordForm.addEventListener("submit", async (e) => {
          e.preventDefault();

          const email = document.getElementById("resetEmail").value;

          try {
            const response = await fetch(
              "https://operators-dashboard.bubbleapps.io/api/1.1/wf/webflow_forgotpassword",
              {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  email: email,
                }),
              }
            );

            const data = await response.json();
            if (response.ok) {
              toastMessage.textContent =
                "Password reset instructions sent to your email!";
              toast.show();
              // Clear the form
              forgotPasswordForm.reset();
            } else {
              toastMessage.textContent =
                "Password reset failed: " + (data.message || "Unknown error");
              toast.show();
            }
          } catch (error) {
            toastMessage.textContent =
              "An error occurred during password reset. Please try again.";
            toast.show();
          }
        });
      });
    </script>

    <script>
      var input = document.querySelector("#phone");
      window.intlTelInput(input, {
        utilsScript: "https://babunewgit1.github.io/phonenumber/phn/utils.js",
      });
    </script>
  </body>
</html>
